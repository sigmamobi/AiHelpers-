# План следующих шагов для AI Assistant

Этот документ описывает приоритетные задачи, предложения по улучшению и возможные будущие функции для проекта AI Assistant. Он служит дорожной картой для дальнейшей разработки.

## 1. Текущий статус проекта (Кратко)

*   **Основа приложения**: Создана с использованием React Native + Expo (фронтенд) и Supabase (бэкенд).
*   **Основные экраны**: Реализованы (Аутентификация, Главный, Список Ассистентов, Чат, Настройки).
*   **Аутентификация**: Базовая аутентификация через Supabase Auth (email/пароль, magic link, демо-режим) функционирует.
*   **База данных**: Схема создана в Supabase, включая таблицы для пользователей, ассистентов, чатов, сообщений. Начальные данные для ассистентов загружены.
*   **Edge Function**: Функция `generate_ai_response` для взаимодействия с OpenAI API развернута.
*   **Локализация**: Начальная поддержка английского и русского языков внедрена.
*   **UI**: Интегрированы логотип и сплэш-скрин. Базовый UI на стандартных компонентах React Native.
*   **Сборка**: Обсуждались и частично решались вопросы сборки APK.

## 2. Приоритетные задачи (MVP и стабилизация)

Эти задачи необходимо выполнить для достижения стабильной минимально жизнеспособной версии продукта (MVP) и обеспечения его корректной работы.

### 2.1. Стабилизация основного функционала
*   **Тестирование и отладка аутентификации**:
    *   [ ] Тщательно протестировать все сценарии входа, регистрации, выхода, восстановления пароля (если реализовано) и magic link.
    *   [ ] Убедиться в корректной работе демо-режима и плавном переходе из него в полноценный режим.
*   **Стабилизация чата**:
    *   [ ] Проверить и отладить отправку и получение сообщений в реальном времени через Supabase Realtime.
    *   [ ] Убедиться, что Edge Function `generate_ai_response` корректно обрабатывает запросы, вызывает OpenAI API и сохраняет ответы.
    *   [ ] Проверить, что системный промпт выбранного ассистента правильно передается и используется в Edge Function.
    *   [ ] Убедиться, что выбранная пользователем модель AI (из настроек) корректно используется для генерации ответов.
    *   [ ] Реализовать корректное отображение индикатора "AI печатает..." и его скрытие.
*   **Обработка ошибок**:
    *   [ ] Добавить более информативные сообщения об ошибках для пользователя во всех частях приложения (сеть, API, база данных).
    *   [ ] Улучшить логирование ошибок на стороне клиента и в Edge Function для упрощения отладки.

### 2.2. Работа с данными и Supabase
*   **Загрузка и отображение данных**:
    *   [ ] Реализовать загрузку списка чатов на главном экране (`HomeScreen`) из Supabase.
    *   [ ] Реализовать загрузку списка ассистентов на экране `AssistantsScreen` из Supabase.
    *   [ ] Реализовать загрузку и сохранение настроек пользователя (`SettingsScreen`) в Supabase.
    *   [ ] Обеспечить корректное создание нового чата в базе данных при выборе ассистента.
*   **RLS и безопасность**:
    *   [ ] Еще раз проверить и протестировать все политики Row-Level Security (RLS) для таблиц Supabase, чтобы гарантировать, что пользователи имеют доступ только к своим данным.
*   **Миграции базы данных**:
    *   [ ] Все последующие изменения схемы БД производить через систему миграций Supabase (`supabase/migrations/`).

### 2.3. UI/UX улучшения
*   **Индикаторы загрузки**:
    *   [ ] Добавить индикаторы загрузки на всех экранах, где происходит загрузка данных (чаты, ассистенты, сообщения, настройки).
*   **Обратная связь**:
    *   [ ] Улучшить визуальную обратную связь при выполнении действий (например, сохранение настроек, отправка сообщения).
*   **Дизайн**:
    *   [ ] Привести UI в соответствие с предоставленными мокапами (если таковые имеются) или разработать консистентный дизайн.
    *   [ ] Проверить адаптивность UI на различных размерах экранов (особенно для веб-версии).

### 2.4. Локализация
*   **Полный перевод**:
    *   [ ] Перевести все оставшиеся строки интерфейса, системные сообщения и описания на русский язык.
    *   [ ] Протестировать корректное переключение языка и отображение контента на обоих языках.
*   **Локализация данных**:
    *   [ ] Убедиться, что названия и описания ассистентов загружаются на выбранном пользователем языке (поля `name_ru`, `description_ru` и т.д. в таблице `assistants`).

### 2.5. Сборка и развертывание
*   **APK для Android**:
    *   [ ] Окончательно решить проблемы со сборкой APK (установка JDK, настройка Android SDK, разрешение конфликтов зависимостей). См. [Инструкции по сборке APK](./APK_BUILD_INSTRUCTIONS.md).
    *   [ ] Протестировать собранный APK на реальных Android-устройствах.
*   **Веб-версия**:
    *   [ ] Обеспечить стабильную работу веб-версии.
    *   [ ] Подготовить к развертыванию (например, на Vercel или Netlify).
*   **iOS (если планируется)**:
    *   [ ] Настроить сборку для iOS через EAS Build (потребуется аккаунт разработчика Apple).

## 3. Предложения по улучшению (после MVP)

После стабилизации MVP, можно сосредоточиться на улучшении качества кода, производительности и пользовательского опыта.

### 3.1. Качество кода и рефакторинг
*   **TypeScript**:
    *   [ ] Постепенно перевести основные компоненты и утилиты на TypeScript для улучшения типизации и уменьшения ошибок.
*   **Модульность**:
    *   [ ] Рефакторинг `lib/supabase.js` для лучшего разделения ответственности (например, отдельные модули для auth, db, functions).
    *   [ ] Выделение переиспользуемых UI-компонентов в отдельную директорию или пакет.
*   **Управление состоянием**:
    *   [ ] Рассмотреть внедрение более продвинутой библиотеки управления состоянием (например, Zustand, Jotai или React Query/TanStack Query), если `AuthContext` и `LocalizationContext` станет недостаточно. React Query особенно полезен для управления серверным состоянием (запросы к Supabase).
*   **Чистота кода**:
    *   [ ] Провести ревью кода, удалить неиспользуемый код, улучшить комментарии.

### 3.2. Производительность
*   **Оптимизация списков**:
    *   [ ] Использовать `FlatList` с `keyExtractor`, `getItemLayout` (если применимо) и `windowSize` для оптимизации рендеринга длинных списков чатов, ассистентов и сообщений.
    *   [ ] Рассмотреть виртуализацию для очень длинных списков.
*   **Ленивая загрузка (Lazy Loading)**:
    *   [ ] Для изображений и других тяжелых ресурсов.
*   **Размер бандла**:
    *   [ ] Проанализировать размер бандла приложения и найти возможности для его уменьшения.

### 3.3. Тестирование
*   **Unit-тесты**:
    *   [ ] Написать юнит-тесты для ключевых функций в `lib/` и для логики в компонентах с использованием Jest.
*   **Интеграционные тесты**:
    *   [ ] Протестировать взаимодействие компонентов с Supabase.
*   **E2E тесты (End-to-End)**:
    *   [ ] Рассмотреть возможность использования Detox (для React Native) или Playwright/Cypress (для веб-версии) для автоматизации ключевых пользовательских сценариев.

### 3.4. CI/CD (Непрерывная интеграция и доставка)
*   **Автоматизация сборок**:
    *   [ ] Настроить GitHub Actions (или другой CI/CD сервис) для автоматической сборки и тестирования приложения при каждом push в репозиторий.
    *   [ ] Автоматизировать деплой веб-версии.
    *   [ ] Автоматизировать отправку сборок в TestFlight (iOS) и Google Play Console (Android) для внутреннего тестирования.

## 4. Возможные будущие функции

После того как MVP будет стабильным и основные улучшения внедрены, можно рассмотреть добавление новых функций:

### 4.1. Расширенное управление ассистентами
*   [ ] **Создание ассистентов пользователями**: Позволить пользователям создавать и настраивать своих собственных AI-ассистентов.
*   [ ] **Публикация и обмен ассистентами**: Возможность делиться созданными ассистентами с другими пользователями или публиковать их в общем каталоге.
*   [ ] **Рейтинги и отзывы**: Система оценки ассистентов пользователями.

### 4.2. Улучшения чата
*   [ ] **Стриминг ответов AI**: Отображение ответов AI по мере их генерации (как в ChatGPT), а не после полной генерации. Потребует изменений в Edge Function (возможно, Server-Sent Events) и на клиенте.
*   [ ] **Поддержка Markdown**: Рендеринг Markdown в сообщениях чата (форматирование текста, списки, ссылки, код).
*   [ ] **Вложения**: Возможность отправлять и получать изображения или файлы в чате (потребует настройки Supabase Storage).
*   [ ] **Голосовой ввод/вывод**: Интеграция распознавания и синтеза речи.
*   [ ] **Поиск по истории чатов**.
*   [ ] **Редактирование и удаление сообщений** (если это соответствует концепции).

### 4.3. Профиль пользователя
*   [ ] **Загрузка аватара**: Использование Supabase Storage для хранения аватаров пользователей.
*   [ ] **Более детальные настройки профиля**.

### 4.4. Уведомления
*   [ ] **Push-уведомления**: Оповещения о новых сообщениях или важных событиях (через Expo Push Notifications или нативные сервисы).

### 4.5. Офлайн-режим
*   [ ] **Кэширование данных**: Сохранение чатов и сообщений для доступа без подключения к интернету.
*   [ ] **Оптимистичные обновления**: Отображение действий пользователя немедленно, даже до подтверждения сервером.

### 4.6. Админ-панель
*   [ ] **Веб-интерфейс для администраторов**: Для управления пользователями, ассистентами, просмотра статистики, модерации контента и т.д. (можно создать на Next.js, Retool или использовать готовые решения для Supabase).

### 4.7. Аналитика
*   [ ] Сбор анонимной статистики использования приложения для понимания поведения пользователей и улучшения продукта.

Этот план является ориентировочным и может изменяться в зависимости от приоритетов и ресурсов. Регулярный пересмотр и обновление этого документа помогут держать разработку в фокусе.

---
См. также:
*   [Руководство по разработке (Архитектура, Потоки данных)](./DEVELOPMENT_GUIDE.md)
*   [Инструкции по настройке проекта](./SUPABASE_SETUP.md)
